<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="VM-specific methods for reference processing, including weak references, and finalizers. We handle weak references and finalizers differently:"><title>ReferenceGlue in mmtk::vm - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="mmtk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0 (aedd173a2 2024-03-17)" data-channel="1.77.0" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../mmtk/index.html">mmtk</a><span class="version">0.29.0-cd2fe83dc84a264da17df81875517b7406ec7617</span></h2></div><h2 class="location"><a href="#">ReferenceGlue</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.FinalizableType">FinalizableType</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.clear_referent">clear_referent</a></li><li><a href="#tymethod.enqueue_references">enqueue_references</a></li><li><a href="#tymethod.get_referent">get_referent</a></li><li><a href="#tymethod.set_referent">set_referent</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In mmtk::vm</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../mmtk/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">mmtk</a>::<wbr><a href="index.html">vm</a>::<wbr><a class="trait" href="#">ReferenceGlue</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/mmtk/vm/reference_glue.rs.html#15-50">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait ReferenceGlue&lt;VM: <a class="trait" href="trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; {
    type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="reference_glue/trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a>;

    // Required methods
    fn <a href="#tymethod.clear_referent" class="fn">clear_referent</a>(new_reference: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.get_referent" class="fn">get_referent</a>(object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.77.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.set_referent" class="fn">set_referent</a>(reff: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.enqueue_references" class="fn">enqueue_references</a>(references: &amp;[<a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>], tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>);
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>VM-specific methods for reference processing, including weak references, and finalizers.
We handle weak references and finalizers differently:</p>
<ul>
<li>for weak references, we assume they are implemented as normal reference objects (also known as weak objects)
with a referent that is actually weakly reachable. This trait provides a few methods to access
the referent of such an reference object.</li>
<li>for finalizers, we provide a <code>Finalizable</code> trait, and require bindings to specify a type
that implements <code>Finalizable</code>. When the binding registers or pops a finalizable object
from MMTk, the specified type is used for the finalizable objects. For most languages,
they can just use <code>ObjectReference</code> for the finalizable type, meaning that they are registering
and popping a normal object reference as finalizable objects.</li>
</ul>
</div></details><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><details class="toggle" open><summary><section id="associatedtype.FinalizableType" class="method"><a class="src rightside" href="../../src/mmtk/vm/reference_glue.rs.html#17">source</a><h4 class="code-header">type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="reference_glue/trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a></h4></section></summary><div class="docblock"><p>The type of finalizable objects. This type is used when the binding registers and pops finalizable objects.</p>
</div></details></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.clear_referent" class="method"><a class="src rightside" href="../../src/mmtk/vm/reference_glue.rs.html#26">source</a><h4 class="code-header">fn <a href="#tymethod.clear_referent" class="fn">clear_referent</a>(new_reference: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></section></summary><div class="docblock"><p>Weak and soft references always clear the referent
before enqueueing.</p>
<p>Arguments:</p>
<ul>
<li><code>new_reference</code>: The reference whose referent is to be cleared.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_referent" class="method"><a class="src rightside" href="../../src/mmtk/vm/reference_glue.rs.html#33">source</a><h4 class="code-header">fn <a href="#tymethod.get_referent" class="fn">get_referent</a>(object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.77.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>&gt;</h4></section></summary><div class="docblock"><p>Get the referent from a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>object</code>: Reference to the referent.  <code>None</code> if the object currently does not point to a
referent.  This may happen if the reference has been cleared.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.set_referent" class="method"><a class="src rightside" href="../../src/mmtk/vm/reference_glue.rs.html#40">source</a><h4 class="code-header">fn <a href="#tymethod.set_referent" class="fn">set_referent</a>(reff: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></section></summary><div class="docblock"><p>Set the referent in a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>reff</code>: The object reference for the reference.</li>
<li><code>referent</code>: The referent object reference.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.enqueue_references" class="method"><a class="src rightside" href="../../src/mmtk/vm/reference_glue.rs.html#49">source</a><h4 class="code-header">fn <a href="#tymethod.enqueue_references" class="fn">enqueue_references</a>(references: &amp;[<a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>], tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>)</h4></section></summary><div class="docblock"><p>For weak reference types, if the referent is cleared during GC, the reference
will be added to a queue, and MMTk will call this method to inform
the VM about the changes for those references. This method is used
to implement Java’s ReferenceQueue.
Note that this method is called for each type of weak references during GC, and
the references slice will be cleared after this call is returned. That means
MMTk will no longer keep these references alive once this method is returned.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/1.77.0/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../trait.impl/mmtk/vm/reference_glue/trait.ReferenceGlue.js" async></script></section></div></main></body></html>