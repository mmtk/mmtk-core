<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An `Mmapper` manages the mmap state of memory used by the heap and side metadata of MMTk."><title>Mmapper in mmtk::util::heap::layout::mmapper - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../../../../../" data-static-root-path="../../../../../static.files/" data-current-crate="mmtk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0 (90b35a623 2024-11-26)" data-channel="1.83.0" data-search-js="search-f0d225181b97f9a4.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../../../../../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../../../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../../../../../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../../../mmtk/index.html">mmtk</a><span class="version">0.31.0-a9074a3ec186ccd365481874332c99e1a25a7654</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Mmapper</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.ensure_mapped" title="ensure_mapped">ensure_mapped</a></li><li><a href="#tymethod.is_mapped_address" title="is_mapped_address">is_mapped_address</a></li><li><a href="#tymethod.log_granularity" title="log_granularity">log_granularity</a></li><li><a href="#tymethod.log_mappable_bytes" title="log_mappable_bytes">log_mappable_bytes</a></li><li><a href="#tymethod.mark_as_mapped" title="mark_as_mapped">mark_as_mapped</a></li><li><a href="#tymethod.quarantine_address_range" title="quarantine_address_range">quarantine_address_range</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.granularity" title="granularity">granularity</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In mmtk::<wbr>util::<wbr>heap::<wbr>layout::<wbr>mmapper</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../../../index.html">mmtk</a>::<wbr><a href="../../../index.html">util</a>::<wbr><a href="../../index.html">heap</a>::<wbr><a href="../index.html">layout</a>::<wbr><a href="index.html">mmapper</a></span><h1>Trait <span class="trait">Mmapper</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#36-110">source</a> </span></div><pre class="rust item-decl"><code>pub trait Mmapper: <a class="trait" href="https://doc.rust-lang.org/1.83.0/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Required methods
    fn <a href="#tymethod.log_granularity" class="fn">log_granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.u8.html">u8</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.log_mappable_bytes" class="fn">log_mappable_bytes</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.u8.html">u8</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.mark_as_mapped" class="fn">mark_as_mapped</a>(&amp;self, start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>, bytes: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.quarantine_address_range" class="fn">quarantine_address_range</a>(
        &amp;self,
        start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>,
        pages: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        strategy: <a class="struct" href="../../../memory/struct.MmapStrategy.html" title="struct mmtk::util::memory::MmapStrategy">MmapStrategy</a>,
        anno: &amp;<a class="enum" href="../../../memory/enum.MmapAnnotation.html" title="enum mmtk::util::memory::MmapAnnotation">MmapAnnotation</a>&lt;'_&gt;,
    ) -&gt; <a class="type" href="https://doc.rust-lang.org/1.83.0/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.ensure_mapped" class="fn">ensure_mapped</a>(
        &amp;self,
        start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>,
        pages: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        strategy: <a class="struct" href="../../../memory/struct.MmapStrategy.html" title="struct mmtk::util::memory::MmapStrategy">MmapStrategy</a>,
        anno: &amp;<a class="enum" href="../../../memory/enum.MmapAnnotation.html" title="enum mmtk::util::memory::MmapAnnotation">MmapAnnotation</a>&lt;'_&gt;,
    ) -&gt; <a class="type" href="https://doc.rust-lang.org/1.83.0/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.is_mapped_address" class="fn">is_mapped_address</a>(&amp;self, addr: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a>;

    // Provided method
    fn <a href="#method.granularity" class="fn">granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a> { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An <code>Mmapper</code> manages the mmap state of memory used by the heap and side metadata of MMTk.</p>
<p>For the efficiency of implementation, an <code>Mmapper</code> operates at the granularity of
<a href="trait.Mmapper.html#method.granularity" title="method mmtk::util::heap::layout::mmapper::Mmapper::granularity"><code>Mmapper::granularity()</code></a>.  Methods that take memory ranges as arguments will round the range
to the overlapping chunks.</p>
<p>From the perspective of the <code>Mmapper</code>, each memory range can be in one of the three states:
Unmapped, Quarantined, and Mapped.  The state transition graph is:</p>
<div class="example-wrap"><pre class="language-text"><code>┌────────┐  ensure_mapped / mark_as_mapped    ┌──────┐
│Unmapped├────────────────────────────────────►Mapped│
└───┬────┘                                    └───▲──┘
    │               ┌───────────┐                 │
    └───────────────►Quarantined├─────────────────┘
        quarantine  └───────────┘  ensure_mapped</code></pre></div>
<ul>
<li><strong>Unmapped</strong> means the memory is not mapped by the <code>Mmapper</code>, and may be mapped by other
components of the process.</li>
<li><strong>Quarantined</strong> means the <code>Mmapper</code> has reserved the memory for MMTk, usually by using
<code>mmap</code> with <code>PROT_NONE</code>.</li>
<li><strong>Mapped</strong> means <code>Mmapper</code> has mapped the memory, and the memory can be read and written by
MMTk.</li>
</ul>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.log_granularity" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#41">source</a><h4 class="code-header">fn <a href="#tymethod.log_granularity" class="fn">log_granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.u8.html">u8</a></h4></section></summary><div class="docblock"><p>The logarithm of granularity of this <code>Mmapper</code>, in bytes.  Must be at least
<a href="../../../constants/constant.LOG_BYTES_IN_PAGE.html" title="constant mmtk::util::constants::LOG_BYTES_IN_PAGE"><code>LOG_BYTES_IN_PAGE</code></a>.</p>
<p>See trait-level doc for <a href="trait.Mmapper.html" title="trait mmtk::util::heap::layout::mmapper::Mmapper"><code>Mmapper</code></a> for details.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.log_mappable_bytes" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#47">source</a><h4 class="code-header">fn <a href="#tymethod.log_mappable_bytes" class="fn">log_mappable_bytes</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.u8.html">u8</a></h4></section></summary><div class="docblock"><p>The logarithm of the address space size this <code>Mmapper</code> can handle.</p>
<p>In other words, this <code>Mmapper</code> cannot handle addresses greater than or equal to
<code>1 &lt;&lt; self.log_mappable_bytes()</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.mark_as_mapped" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#64">source</a><h4 class="code-header">fn <a href="#tymethod.mark_as_mapped" class="fn">mark_as_mapped</a>(&amp;self, start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>, bytes: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>)</h4></section></summary><div class="docblock"><p>Mark a number of pages as mapped, without making any
request to the operating system.  Used to mark pages
that the VM has already mapped.</p>
<p>Arguments:</p>
<ul>
<li><code>start</code>: Address of the first page to be mapped</li>
<li><code>bytes</code>: Number of bytes to ensure mapped</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.quarantine_address_range" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#76-82">source</a><h4 class="code-header">fn <a href="#tymethod.quarantine_address_range" class="fn">quarantine_address_range</a>(
    &amp;self,
    start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>,
    pages: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    strategy: <a class="struct" href="../../../memory/struct.MmapStrategy.html" title="struct mmtk::util::memory::MmapStrategy">MmapStrategy</a>,
    anno: &amp;<a class="enum" href="../../../memory/enum.MmapAnnotation.html" title="enum mmtk::util::memory::MmapAnnotation">MmapAnnotation</a>&lt;'_&gt;,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.83.0/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Quarantine/reserve address range. We mmap from the OS with no reserve and with PROT_NONE,
which should be little overhead. This ensures that we can reserve certain address range that
we can use if needed. Quarantined memory needs to be mapped before it can be used.</p>
<p>Arguments:</p>
<ul>
<li><code>start</code>: Address of the first page to be quarantined</li>
<li><code>pages</code>: Number of pages to quarantine from the start</li>
<li><code>strategy</code>: The mmap strategy.  The <code>prot</code> field is ignored because we always use
<code>PROT_NONE</code>.</li>
<li><code>anno</code>: Human-readable annotation to apply to newly mapped memory ranges.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.ensure_mapped" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#96-102">source</a><h4 class="code-header">fn <a href="#tymethod.ensure_mapped" class="fn">ensure_mapped</a>(
    &amp;self,
    start: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>,
    pages: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    strategy: <a class="struct" href="../../../memory/struct.MmapStrategy.html" title="struct mmtk::util::memory::MmapStrategy">MmapStrategy</a>,
    anno: &amp;<a class="enum" href="../../../memory/enum.MmapAnnotation.html" title="enum mmtk::util::memory::MmapAnnotation">MmapAnnotation</a>&lt;'_&gt;,
) -&gt; <a class="type" href="https://doc.rust-lang.org/1.83.0/std/io/error/type.Result.html" title="type std::io::error::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Ensure that a range of pages is mmapped (or equivalent).  If the
pages are not yet mapped, demand-zero map them. Note that mapping
occurs at chunk granularity, not page granularity.</p>
<p>Arguments:</p>
<ul>
<li><code>start</code>: The start of the range to be mapped.</li>
<li><code>pages</code>: The size of the range to be mapped, in pages</li>
<li><code>strategy</code>: The mmap strategy.</li>
<li><code>anno</code>: Human-readable annotation to apply to newly mapped memory ranges.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.is_mapped_address" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#109">source</a><h4 class="code-header">fn <a href="#tymethod.is_mapped_address" class="fn">is_mapped_address</a>(&amp;self, addr: <a class="struct" href="../../../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Is the page pointed to by this address mapped? Returns true if
the page at the given address is mapped.</p>
<p>Arguments:</p>
<ul>
<li><code>addr</code>: Address in question</li>
</ul>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.granularity" class="method"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/mod.rs.html#53-55">source</a><h4 class="code-header">fn <a href="#method.granularity" class="fn">granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>The granularity of <code>Mmapper</code>.  Don’t override this method.  Override
<a href="trait.Mmapper.html#tymethod.log_granularity" title="method mmtk::util::heap::layout::mmapper::Mmapper::log_granularity"><code>Mmapper::log_granularity</code></a> instead.</p>
<p>See trait-level doc for <a href="trait.Mmapper.html" title="trait mmtk::util::heap::layout::mmapper::Mmapper"><code>Mmapper</code></a> for details.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-Mmapper-for-ChunkStateMmapper" class="impl"><a class="src rightside" href="../../../../../src/mmtk/util/heap/layout/mmapper/csm/mod.rs.html#129-214">source</a><a href="#impl-Mmapper-for-ChunkStateMmapper" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Mmapper.html" title="trait mmtk::util::heap::layout::mmapper::Mmapper">Mmapper</a> for <a class="struct" href="csm/struct.ChunkStateMmapper.html" title="struct mmtk::util::heap::layout::mmapper::csm::ChunkStateMmapper">ChunkStateMmapper</a></h3></section></div><script src="../../../../../trait.impl/mmtk/util/heap/layout/mmapper/trait.Mmapper.js" async></script></section></div></main></body></html>