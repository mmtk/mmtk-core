<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A trait which implements allocation routines. Every allocator needs to implements this trait."><title>Allocator in mmtk::util::alloc - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="mmtk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0 (90b35a623 2024-11-26)" data-channel="1.83.0" data-search-js="search-f0d225181b97f9a4.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../../../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../mmtk/index.html">mmtk</a><span class="version">0.31.0-31a78a41f02fc7228780b501c4944ba750e32ee4</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Allocator</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.alloc" title="alloc">alloc</a></li><li><a href="#tymethod.alloc_slow_once" title="alloc_slow_once">alloc_slow_once</a></li><li><a href="#tymethod.does_thread_local_allocation" title="does_thread_local_allocation">does_thread_local_allocation</a></li><li><a href="#tymethod.get_context" title="get_context">get_context</a></li><li><a href="#tymethod.get_space" title="get_space">get_space</a></li><li><a href="#tymethod.get_tls" title="get_tls">get_tls</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.alloc_slow" title="alloc_slow">alloc_slow</a></li><li><a href="#method.alloc_slow_inline" title="alloc_slow_inline">alloc_slow_inline</a></li><li><a href="#method.alloc_slow_once_precise_stress" title="alloc_slow_once_precise_stress">alloc_slow_once_precise_stress</a></li><li><a href="#method.alloc_slow_once_traced" title="alloc_slow_once_traced">alloc_slow_once_traced</a></li><li><a href="#method.alloc_slow_with_options" title="alloc_slow_with_options">alloc_slow_with_options</a></li><li><a href="#method.alloc_with_options" title="alloc_with_options">alloc_with_options</a></li><li><a href="#method.get_thread_local_buffer_granularity" title="get_thread_local_buffer_granularity">get_thread_local_buffer_granularity</a></li><li><a href="#method.on_mutator_destroy" title="on_mutator_destroy">on_mutator_destroy</a></li></ul><h3><a href="#implementations">Methods</a></h3><ul class="block method"><li><a href="#method.downcast" title="downcast">downcast</a></li><li><a href="#method.downcast_mut" title="downcast_mut">downcast_mut</a></li><li><a href="#method.downcast_rc" title="downcast_rc">downcast_rc</a></li><li><a href="#method.downcast_ref" title="downcast_ref">downcast_ref</a></li><li><a href="#method.is" title="is">is</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2><a href="index.html">In mmtk::<wbr>util::<wbr>alloc</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../../index.html">mmtk</a>::<wbr><a href="../index.html">util</a>::<wbr><a href="index.html">alloc</a></span><h1>Trait <span class="trait">Allocator</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/mmtk/util/alloc/allocator.rs.html#229-563">source</a> </span></div><pre class="rust item-decl"><code>pub trait Allocator&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt;: Downcast {
<details class="toggle type-contents-toggle"><summary class="hideme"><span>Show 14 methods</span></summary>    // Required methods
    fn <a href="#tymethod.get_tls" class="fn">get_tls</a>(&amp;self) -&gt; <a class="struct" href="../opaque_pointer/struct.VMThread.html" title="struct mmtk::util::opaque_pointer::VMThread">VMThread</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.get_space" class="fn">get_space</a>(&amp;self) -&gt; &amp;'static dyn <a class="trait" href="../../policy/space/trait.Space.html" title="trait mmtk::policy::space::Space">Space</a>&lt;VM&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.get_context" class="fn">get_context</a>(&amp;self) -&gt; &amp;<a class="struct" href="allocator/struct.AllocatorContext.html" title="struct mmtk::util::alloc::allocator::AllocatorContext">AllocatorContext</a>&lt;VM&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.does_thread_local_allocation" class="fn">does_thread_local_allocation</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.alloc" class="fn">alloc</a>(&amp;mut self, size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.alloc_slow_once" class="fn">alloc_slow_once</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a>;

    // Provided methods
    fn <a href="#method.get_thread_local_buffer_granularity" class="fn">get_thread_local_buffer_granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_with_options" class="fn">alloc_with_options</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        alloc_options: <a class="struct" href="allocator/struct.AllocationOptions.html" title="struct mmtk::util::alloc::allocator::AllocationOptions">AllocationOptions</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_slow" class="fn">alloc_slow</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_slow_with_options" class="fn">alloc_slow_with_options</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        alloc_options: <a class="struct" href="allocator/struct.AllocationOptions.html" title="struct mmtk::util::alloc::allocator::AllocationOptions">AllocationOptions</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_slow_inline" class="fn">alloc_slow_inline</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_slow_once_traced" class="fn">alloc_slow_once_traced</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.alloc_slow_once_precise_stress" class="fn">alloc_slow_once_precise_stress</a>(
        &amp;mut self,
        size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
        need_poll: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a>,
    ) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.on_mutator_destroy" class="fn">on_mutator_destroy</a>(&amp;mut self) { ... }
</details>}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A trait which implements allocation routines. Every allocator needs to implements this trait.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.get_tls" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#231">source</a><h4 class="code-header">fn <a href="#tymethod.get_tls" class="fn">get_tls</a>(&amp;self) -&gt; <a class="struct" href="../opaque_pointer/struct.VMThread.html" title="struct mmtk::util::opaque_pointer::VMThread">VMThread</a></h4></section></summary><div class="docblock"><p>Return the <a href="../opaque_pointer/struct.VMThread.html" title="struct mmtk::util::opaque_pointer::VMThread"><code>VMThread</code></a> associated with this allocator instance.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_space" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#234">source</a><h4 class="code-header">fn <a href="#tymethod.get_space" class="fn">get_space</a>(&amp;self) -&gt; &amp;'static dyn <a class="trait" href="../../policy/space/trait.Space.html" title="trait mmtk::policy::space::Space">Space</a>&lt;VM&gt;</h4></section></summary><div class="docblock"><p>Return the <a href="src/policy/space/Space"><code>Space</code></a> instance associated with this allocator instance.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_context" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#237">source</a><h4 class="code-header">fn <a href="#tymethod.get_context" class="fn">get_context</a>(&amp;self) -&gt; &amp;<a class="struct" href="allocator/struct.AllocatorContext.html" title="struct mmtk::util::alloc::allocator::AllocatorContext">AllocatorContext</a>&lt;VM&gt;</h4></section></summary><div class="docblock"><p>Return the context for the allocator.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.does_thread_local_allocation" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#241">source</a><h4 class="code-header">fn <a href="#tymethod.does_thread_local_allocation" class="fn">does_thread_local_allocation</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Return if this allocator can do thread local allocation. If an allocator does not do thread
local allocation, each allocation will go to slowpath and will have a check for GC polls.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.alloc" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#273">source</a><h4 class="code-header">fn <a href="#tymethod.alloc" class="fn">alloc</a>(&amp;mut self, size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>An allocation attempt. The implementation of this function depends on the allocator used.
If an allocator supports thread local allocations, then the allocation will be serviced
from its TLAB, otherwise it will default to using the slowpath, i.e. <a href="allocator/trait.Allocator.html#method.alloc_slow" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow"><code>alloc_slow</code></a>.</p>
<p>If the heap is full, we trigger a GC and attempt to free up
more memory, and re-attempt the allocation.</p>
<p>Note that in the case where the VM is out of memory, we invoke
<a href="../../vm/collection/trait.Collection.html#method.out_of_memory" title="associated function mmtk::vm::collection::Collection::out_of_memory"><code>Collection::out_of_memory</code></a> to inform the binding and then return a null pointer back to
it. We have no assumptions on whether the VM will continue executing or abort immediately.
If the VM continues execution, the function will return a null address.</p>
<p>An allocator needs to make sure the object reference for the returned address is in the same
chunk as the returned address (so the side metadata and the SFT for an object reference is valid).
See <a href="util/alloc/object_ref_guard"><code>crate::util::alloc::object_ref_guard</code></a>.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.alloc_slow_once" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#498">source</a><h4 class="code-header">fn <a href="#tymethod.alloc_slow_once" class="fn">alloc_slow_once</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>Single slow path allocation attempt. This is called by <a href="allocator/trait.Allocator.html#method.alloc_slow_inline" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow_inline"><code>alloc_slow_inline</code></a>. The
implementation of this function depends on the allocator used. Generally, if an allocator
supports thread local allocations, it will try to allocate more TLAB space here. If it
doesn’t, then (generally) the allocator simply allocates enough space for the current
object.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.get_thread_local_buffer_granularity" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#248-251">source</a><h4 class="code-header">fn <a href="#method.get_thread_local_buffer_granularity" class="fn">get_thread_local_buffer_granularity</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>Return at which granularity the allocator acquires memory from the global space and use
them as thread local buffer. For example, the <a href="bumpallocator/struct.BumpAllocator.html" title="struct mmtk::util::alloc::bumpallocator::BumpAllocator"><code>BumpAllocator</code></a> acquires memory at 32KB
blocks. Depending on the actual size for the current object, they always acquire memory of
N*32KB (N&gt;=1). Thus the <a href="bumpallocator/struct.BumpAllocator.html" title="struct mmtk::util::alloc::bumpallocator::BumpAllocator"><code>BumpAllocator</code></a> returns 32KB for this method.  Only allocators
that do thread local allocation need to implement this method.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_with_options" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#282-293">source</a><h4 class="code-header">fn <a href="#method.alloc_with_options" class="fn">alloc_with_options</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    alloc_options: <a class="struct" href="allocator/struct.AllocationOptions.html" title="struct mmtk::util::alloc::allocator::AllocationOptions">AllocationOptions</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>An allocation attempt. The allocation options may specify different behaviors for this allocation request.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
<li><code>options</code>: the allocation options to change the default allocation behavior for this request.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_slow" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#303-305">source</a><h4 class="code-header">fn <a href="#method.alloc_slow" class="fn">alloc_slow</a>(&amp;mut self, size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>, offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>Slowpath allocation attempt. This function is explicitly not inlined for performance
considerations.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_slow_with_options" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#317-329">source</a><h4 class="code-header">fn <a href="#method.alloc_slow_with_options" class="fn">alloc_slow_with_options</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    alloc_options: <a class="struct" href="allocator/struct.AllocationOptions.html" title="struct mmtk::util::alloc::allocator::AllocationOptions">AllocationOptions</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>Slowpath allocation attempt. Mostly the same as <a href="allocator/trait.Allocator.html#method.alloc_slow" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow"><code>Allocator::alloc_slow</code></a>, except that the allocation options
may specify different behaviors for this allocation request.</p>
<p>This function is not used internally. It is mostly for the bindings.
<a href="allocator/trait.Allocator.html#method.alloc_with_options" title="method mmtk::util::alloc::allocator::Allocator::alloc_with_options"><code>Allocator::alloc_with_options</code></a> still calls the normal <a href="allocator/trait.Allocator.html#method.alloc_slow" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow"><code>Allocator::alloc_slow</code></a>.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_slow_inline" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#347-486">source</a><h4 class="code-header">fn <a href="#method.alloc_slow_inline" class="fn">alloc_slow_inline</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>Slowpath allocation attempt. This function executes the actual slowpath allocation.  A
slowpath allocation in MMTk attempts to allocate the object using the per-allocator
definition of <a href="allocator/trait.Allocator.html#tymethod.alloc_slow_once" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow_once"><code>alloc_slow_once</code></a>. This function also accounts for increasing the
allocation bytes in order to support stress testing. In case precise stress testing is
being used, the <a href="allocator/trait.Allocator.html#method.alloc_slow_once_precise_stress" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow_once_precise_stress"><code>alloc_slow_once_precise_stress</code></a> function is used instead.</p>
<p>Note that in the case where the VM is out of memory, we invoke
<a href="../../vm/collection/trait.Collection.html#method.out_of_memory" title="associated function mmtk::vm::collection::Collection::out_of_memory"><code>Collection::out_of_memory</code></a> with a <a href="allocator/enum.AllocationError.html#variant.HeapOutOfMemory" title="variant mmtk::util::alloc::allocator::AllocationError::HeapOutOfMemory"><code>AllocationError::HeapOutOfMemory</code></a> error to inform
the binding and then return a null pointer back to it. We have no assumptions on whether
the VM will continue executing or abort immediately on a
<a href="allocator/enum.AllocationError.html#variant.HeapOutOfMemory" title="variant mmtk::util::alloc::allocator::AllocationError::HeapOutOfMemory"><code>AllocationError::HeapOutOfMemory</code></a> error.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_slow_once_traced" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#506-513">source</a><h4 class="code-header">fn <a href="#method.alloc_slow_once_traced" class="fn">alloc_slow_once_traced</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>A wrapper method for <a href="allocator/trait.Allocator.html#tymethod.alloc_slow_once" title="method mmtk::util::alloc::allocator::Allocator::alloc_slow_once"><code>alloc_slow_once</code></a> to insert USDT tracepoints.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.alloc_slow_once_precise_stress" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#543-556">source</a><h4 class="code-header">fn <a href="#method.alloc_slow_once_precise_stress" class="fn">alloc_slow_once_precise_stress</a>(
    &amp;mut self,
    size: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    align: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    offset: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.usize.html">usize</a>,
    need_poll: <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a>,
) -&gt; <a class="struct" href="../address/struct.Address.html" title="struct mmtk::util::address::Address">Address</a></h4></section></summary><div class="docblock"><p>Single slowpath allocation attempt for stress test. When the stress factor is set (e.g. to
N), we would expect for every N bytes allocated, we will trigger a stress GC.  However, for
allocators that do thread local allocation, they may allocate from their thread local
buffer which does not have a GC poll check, and they may even allocate with the JIT
generated allocation fastpath which is unaware of stress test GC. For both cases, we are
not able to guarantee a stress GC is triggered every N bytes. To solve this, when the
stress factor is set, we will call this method instead of the normal alloc_slow_once(). We
expect the implementation of this slow allocation will trick the fastpath so every
allocation will fail in the fastpath, jump to the slow path and eventually call this method
again for the actual allocation.</p>
<p>The actual implementation about how to trick the fastpath may vary. For example, our bump
pointer allocator will set the thread local buffer limit to the buffer size instead of the
buffer end address. In this case, every fastpath check (cursor + size &lt; limit) will fail,
and jump to this slowpath. In the slowpath, we still allocate from the thread local buffer,
and recompute the limit (remaining buffer size).</p>
<p>If an allocator does not do thread local allocation (which returns false for
does_thread_local_allocation()), it does not need to override this method. The default
implementation will simply call allow_slow_once() and it will work fine for allocators that
do not have thread local allocation.</p>
<p>Arguments:</p>
<ul>
<li><code>size</code>: the allocation size in bytes.</li>
<li><code>align</code>: the required alignment in bytes.</li>
<li><code>offset</code> the required offset in bytes.</li>
<li><code>need_poll</code>: if this is true, the implementation must poll for a GC, rather than
attempting to allocate from the local buffer.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.on_mutator_destroy" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#560-562">source</a><h4 class="code-header">fn <a href="#method.on_mutator_destroy" class="fn">on_mutator_destroy</a>(&amp;mut self)</h4></section></summary><div class="docblock"><p>The <a href="../../plan/mutator_context/struct.Mutator.html" title="struct mmtk::plan::mutator_context::Mutator"><code>crate::plan::Mutator</code></a> that includes this allocator is going to be destroyed. Some allocators
may need to save/transfer its thread local data to the space.</p>
</div></details></div><h2 id="implementations" class="section-header">Implementations<a href="#implementations" class="anchor">§</a></h2><div id="implementations-list"><details class="toggle implementors-toggle" open><summary><section id="impl-dyn+Allocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><a href="#impl-dyn+Allocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM&gt; dyn <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;<div class="where">where
    VM: <a class="trait" href="https://doc.rust-lang.org/1.83.0/core/any/trait.Any.html" title="trait core::any::Any">Any</a> + 'static + <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>,</div></h3></section></summary><div class="impl-items"><details class="toggle method-toggle" open><summary><section id="method.is" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><h4 class="code-header">pub fn <a href="#method.is" class="fn">is</a>&lt;__T: <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;&gt;(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.bool.html">bool</a></h4></section></summary><div class="docblock"><p>Returns true if the trait object wraps an object of type <code>__T</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.downcast" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><h4 class="code-header">pub fn <a href="#method.downcast" class="fn">downcast</a>&lt;__T: <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;&gt;(
    self: <a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.83.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;__T&gt;, <a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/boxed/struct.Box.html" title="struct alloc::boxed::Box">Box</a>&lt;Self&gt;&gt;</h4></section></summary><div class="docblock"><p>Returns a boxed object from a boxed trait object if the underlying object is of type
<code>__T</code>. Returns the original boxed trait if it isn’t.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.downcast_rc" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><h4 class="code-header">pub fn <a href="#method.downcast_rc" class="fn">downcast_rc</a>&lt;__T: <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;&gt;(
    self: <a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;Self&gt;,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.83.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;__T&gt;, <a class="struct" href="https://doc.rust-lang.org/1.83.0/alloc/rc/struct.Rc.html" title="struct alloc::rc::Rc">Rc</a>&lt;Self&gt;&gt;</h4></section></summary><div class="docblock"><p>Returns an <code>Rc</code>-ed object from an <code>Rc</code>-ed trait object if the underlying object is of
type <code>__T</code>. Returns the original <code>Rc</code>-ed trait if it isn’t.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.downcast_ref" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><h4 class="code-header">pub fn <a href="#method.downcast_ref" class="fn">downcast_ref</a>&lt;__T: <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;&gt;(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.83.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.reference.html">&amp;__T</a>&gt;</h4></section></summary><div class="docblock"><p>Returns a reference to the object within the trait object if it is of type <code>__T</code>, or
<code>None</code> if it isn’t.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.downcast_mut" class="method"><a class="src rightside" href="../../../src/mmtk/util/alloc/allocator.rs.html#565">source</a><h4 class="code-header">pub fn <a href="#method.downcast_mut" class="fn">downcast_mut</a>&lt;__T: <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt;&gt;(&amp;mut self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.83.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.83.0/std/primitive.reference.html">&amp;mut __T</a>&gt;</h4></section></summary><div class="docblock"><p>Returns a mutable reference to the object within the trait object if it is of type
<code>__T</code>, or <code>None</code> if it isn’t.</p>
</div></details></div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-Allocator%3CVM%3E-for-BumpAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/bumpallocator.rs.html#84-174">source</a><a href="#impl-Allocator%3CVM%3E-for-BumpAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="bumpallocator/struct.BumpAllocator.html" title="struct mmtk::util::alloc::bumpallocator::BumpAllocator">BumpAllocator</a>&lt;VM&gt;</h3></section><section id="impl-Allocator%3CVM%3E-for-FreeListAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/free_list_allocator.rs.html#36-129">source</a><a href="#impl-Allocator%3CVM%3E-for-FreeListAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="free_list_allocator/struct.FreeListAllocator.html" title="struct mmtk::util::alloc::free_list_allocator::FreeListAllocator">FreeListAllocator</a>&lt;VM&gt;</h3></section><section id="impl-Allocator%3CVM%3E-for-ImmixAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/immix_allocator.rs.html#47-166">source</a><a href="#impl-Allocator%3CVM%3E-for-ImmixAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="immix_allocator/struct.ImmixAllocator.html" title="struct mmtk::util::alloc::immix_allocator::ImmixAllocator">ImmixAllocator</a>&lt;VM&gt;</h3></section><section id="impl-Allocator%3CVM%3E-for-LargeObjectAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/large_object_allocator.rs.html#23-65">source</a><a href="#impl-Allocator%3CVM%3E-for-LargeObjectAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="large_object_allocator/struct.LargeObjectAllocator.html" title="struct mmtk::util::alloc::large_object_allocator::LargeObjectAllocator">LargeObjectAllocator</a>&lt;VM&gt;</h3></section><section id="impl-Allocator%3CVM%3E-for-MallocAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/malloc_allocator.rs.html#23-47">source</a><a href="#impl-Allocator%3CVM%3E-for-MallocAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="malloc_allocator/struct.MallocAllocator.html" title="struct mmtk::util::alloc::malloc_allocator::MallocAllocator">MallocAllocator</a>&lt;VM&gt;</h3></section><section id="impl-Allocator%3CVM%3E-for-MarkCompactAllocator%3CVM%3E" class="impl"><a class="src rightside" href="../../../src/mmtk/util/alloc/markcompact_allocator.rs.html#32-89">source</a><a href="#impl-Allocator%3CVM%3E-for-MarkCompactAllocator%3CVM%3E" class="anchor">§</a><h3 class="code-header">impl&lt;VM: <a class="trait" href="../../vm/trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; <a class="trait" href="allocator/trait.Allocator.html" title="trait mmtk::util::alloc::allocator::Allocator">Allocator</a>&lt;VM&gt; for <a class="struct" href="markcompact_allocator/struct.MarkCompactAllocator.html" title="struct mmtk::util::alloc::markcompact_allocator::MarkCompactAllocator">MarkCompactAllocator</a>&lt;VM&gt;</h3></section></div><script src="../../../trait.impl/mmtk/util/alloc/allocator/trait.Allocator.js" async></script></section></div></main></body></html>