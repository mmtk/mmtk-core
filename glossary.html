<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Glossary - MMTk User Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The guide describes the usage of MMTk for GC and language runtime developers.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/css/api-migration-details.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MMTk User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/mmtk/mmtk-core/tree/master/docs/userguide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/mmtk/mmtk-core/edit/master/docs/userguide/src/glossary.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<p>This document explains basic concepts of garbage collection.  MMTk uses those terms as described in
this document.  Different VMs may define some terms differently.  Should there be any confusion,
this document will help disambiguating them.  We use the book <a href="https://gchandbook.org/"><em>The Garbage Collection Handbook: The
Art of Automatic Memory Management</em></a> as the primary reference.</p>
<h2 id="object-graph"><a class="header" href="#object-graph">Object graph</a></h2>
<p>Object graph is a graph-theory view of the garbage-collected heap.  An <strong>object graph</strong> is a
directed graph that contains <em>nodes</em> and <em>edges</em>.  An edge always points to a node.  But unlike
conventional graphs, an edge may originate from either another node or a <em>root</em>.</p>
<p>Each <em>node</em> represents an object in the heap.</p>
<p>Each <em>edge</em> represents an object reference from an object or a root.  A <em>root</em> is a reference held
in a slot directly accessible from <a href="#mutator">mutators</a>, including local variables, global variables,
thread-local variables, and so on.  A object can have many fields, and some fields may hold
references to objects, while others hold non-reference values.</p>
<p>An object is <em>reachable</em> if there is a path in the object graph from any root to the node of the
object.  Unreachable objects cannot be accessed by <a href="#mutator">mutators</a>.  They are considered
garbage, and can be reclaimed by the garbage collector.</p>
<h2 id="mutator"><a class="header" href="#mutator">Mutator</a></h2>
<p>TODO</p>
<h2 id="emergency-collection"><a class="header" href="#emergency-collection">Emergency Collection</a></h2>
<p>Also known as: <em>emergency GC</em></p>
<p>In MMTk, an emergency collection happens when a normal collection cannot reclaim enough memory to
satisfy allocation requests.  Plans may do full-heap GC, defragmentation, etc. during emergency
collections in order to free up more memory.</p>
<p>VM bindings can call <code>MMTK::is_emergency_collection</code> to query if the current GC is an emergency GC.
During emergency GC, the VM binding is recommended to retain fewer objects than normal GCs, to the
extent allowed by the specification of the VM or the language.  For example, the VM binding may
choose not to retain objects used for caching.  Specifically, for Java virtual machines, that means
not retaining referents of <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/ref/SoftReference.html"><code>SoftReference</code></a> which is primarily designed for
implementing memory-sensitive caches.</p>
<h2 id="gc-safe-point"><a class="header" href="#gc-safe-point">GC-safe Point</a></h2>
<p>Also known as: <em>GC-point</em></p>
<p>A <em>GC-safe point</em> is a place in the code executed by mutators where (stop-the-world) garbage
collection is allowed to happen.  Concurrent GC can run concurrently with mutators, but still needs
to synchronize with mutators at GC-safe points.  Regardless, the following statements must be true
when a mutator is at a GC-safe point.</p>
<ul>
<li>References held by a mutator can be identified.  That include references in local variables,
thread-local variables, and so on.  For compiled code, that include those in stack slots and
machine registers.</li>
<li>The mutator cannot be in the middle of operations that must be <em>atomic with respect to GC</em>.
That includes <a href="#write-barrier">write barriers</a>, <a href="#address-based-hashing">address-based hashing</a>, etc.</li>
</ul>
<h3 id="code-with-gc-semantics"><a class="header" href="#code-with-gc-semantics">Code With GC Semantics</a></h3>
<p>Compilers (including ahead-of-time and just-in-time compilers) for programs with garbage collection
semantics (such as Java source code or bytecode) usually understand GC semantics, too, and can
generate <a href="#yieldpoint">yieldpoints</a> and <a href="#stack-map">stack maps</a> to assist GC.</p>
<p>In practice, such compilers only make certain places in a function GC-safe and only generate <a href="#stack-map">stack
maps</a> at those places, including but not limited to:</p>
<ul>
<li><a href="#yieldpoint">yieldpoints</a></li>
<li>object allocation sites (may trigger GC)</li>
<li>call sites to other functions where GC is allowed to happen inside</li>
</ul>
<p>If we allow GC to happen at arbitrary PC, it will either force the compiler to generate <a href="#stack-map">stack maps</a>
at all PCs, or force the VM to use <a href="#shadow-stack">shadow stacks</a> or <a href="#conservative-stack-scanning">conservative stack scanning</a>, instead.  It
will also break operations that must be <em>atomic with respect to GC</em>, such as <a href="#write-barrier">write barrier</a> and
<a href="#address-based-hashing">address-based hashing</a>.</p>
<h3 id="code-without-gc-semantics"><a class="header" href="#code-without-gc-semantics">Code Without GC Semantics</a></h3>
<p>In contrast, for programs without GC semantics (e.g. programs written in C, C++, Rust, etc.), their
compilers (GCC, clang, rustc, ...) are agnostic to GC.  But many VMs (such as OpenJDK, CRuby, Julia,
etc.) are implemented in such languages.  We don't usually use the term "GC-safe point" for
functions written in C, C++, Rust, etc., but each VM has its own rules to determine whether GC can
happen within functions written in those languages.</p>
<p>Interpreters usually maintain local variables in dedicated stacks or frames data structures.
References in such structures are identified by traversing those stacks or frames, and GC is usually
allowed between bytecode instructions.</p>
<p>Some runtime functions implement operations tightly related to GC, and must be <em>atomic w.r.t. GC</em>.
For example, if a function initializes the type information in the header of an object, GC cannot
happen in the middle.  Otherwise the GC will read a corrupted header and crash.  Other examples
include functions that implement the write barrier <a href="#fast-path-and-slow-path">slow path</a> and <a href="#address-based-hashing">address-based hashing</a>.  Such
functions cannot allocate objects, and cannot call any function that may trigger GC.</p>
<p>Some functions do not access the GC heap, or only access the heap in controlled ways (e.g. utilizing
<a href="#object-pinning">object pinning</a>, or via safe APIs such as <a href="https://docs.oracle.com/en/java/javase/21/docs/specs/jni/index.html">JNI</a>).  Some of such functions (such as wrappers for
blocking system calls including <code>read</code> and <code>write</code>) are long-running.  GC is usually safe when some
mutators are executing such functions.  Compilers for languages with GC semantics usually make <em>call
sites</em> to such functions <a href="#gc-safe-point">GC-safe points</a>, and generate <a href="#stack-map">stack maps</a> at those call sites.  The
runtime usually transitions the state of the current mutator thread so that the GC knows it is in
such a function when requesting all mutators to stop at their next GC-safe points.</p>
<h2 id="stack-map"><a class="header" href="#stack-map">Stack Map</a></h2>
<p>A <em>stack map</em> is a data structure that identifies stack slots and registers that may contain
references.  Stack maps are essential for supporting <a href="#precise-stack-scanning">precise stack scanning</a>.</p>
<h2 id="yieldpoint"><a class="header" href="#yieldpoint">Yieldpoint</a></h2>
<p>Also known as: <em>GC-check point</em></p>
<p>A <em>yieldpoint</em> is a point in a program where a mutator thread checks if it should yield from normal
execution in order to handle certain events, such as garbage collection, profiling, biased lock
revocation, etc.</p>
<p>Compilers of programs with GC semantics (e.g. Java source code and byte code) insert yieldpoints in
various places, such as function epilogues and loop back-edges.  In this way, when GC is triggered
asynchronously by other threads, the current mutator can reach the next yieldpoint quickly and yield
for GC promptly.  Compilers also generate <a href="#stack-map">stack maps</a> at yieldpoints to make them <a href="#gc-safe-point">GC-safe points</a>.</p>
<p>Because some operations (such as <a href="#write-barrier">write barrier</a>) must be <em>atomic w.r.t. GC</em>, <a href="#yieldpoint">yieldpoints</a> must not
be inserted in the middle of such operations.</p>
<p>Read the paper <a href="https://dl.acm.org/doi/10.1145/2754169.2754187"><em>Stop and go: Understanding yieldpoint behavior</em></a> by Lin et al. for more
details.</p>
<h2 id="address-based-hashing"><a class="header" href="#address-based-hashing">Address-based Hashing</a></h2>
<p><em>Address-based hashing</em> is a GC-assisted space-efficient high-performance method for implementing
identity hash code in copying GC.</p>
<p>Read the <a href="portingguide/concerns/address-based-hashing.html">Address-based Hashing</a> chapter for more
details.</p>
<h2 id="precise-stack-scanning"><a class="header" href="#precise-stack-scanning">Precise Stack Scanning</a></h2>
<p>Also known as: <em>exact stack scanning</em></p>
<p>TODO</p>
<h2 id="conservative-stack-scanning"><a class="header" href="#conservative-stack-scanning">Conservative Stack Scanning</a></h2>
<p>TODO</p>
<h2 id="shadow-stack"><a class="header" href="#shadow-stack">Shadow Stack</a></h2>
<p>TODO</p>
<h2 id="write-barrier"><a class="header" href="#write-barrier">Write Barrier</a></h2>
<p>TODO</p>
<h2 id="fast-path-and-slow-path"><a class="header" href="#fast-path-and-slow-path">Fast Path and Slow Path</a></h2>
<p>TODO</p>
<h2 id="object-pinning"><a class="header" href="#object-pinning">Object Pinning</a></h2>
<p>TODO</p>
<!--
vim: tw=100 ts=4 sw=4 sts=4 et
-->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="tutorial/prefix.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="tutorial/prefix.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="assets/js/api-migration-details.js"></script>


    </div>
    </body>
</html>
