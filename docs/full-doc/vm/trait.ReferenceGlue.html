<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="VM-specific methods for reference processing, including weak references, and finalizers. We handle weak references and finalizers differently:"><meta name="keywords" content="rust, rustlang, rust-lang, ReferenceGlue"><title>ReferenceGlue in mmtk::vm - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a class="sidebar-logo" href="../../mmtk/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></div>
        </a><h2 class="location">Trait ReferenceGlue</h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#associated-types">Associated Types</a></h3><div class="sidebar-links"><a href="#associatedtype.FinalizableType">FinalizableType</a></div><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><div class="sidebar-links"><a href="#tymethod.enqueue_references">enqueue_references</a><a href="#tymethod.get_referent">get_referent</a><a href="#tymethod.set_referent">set_referent</a></div><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><div class="sidebar-links"><a href="#method.clear_referent">clear_referent</a><a href="#method.is_referent_cleared">is_referent_cleared</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location">Other items in<br><a href="../index.html">mmtk</a>::<wbr><a href="index.html">vm</a></h2><div id="sidebar-vars" data-name="ReferenceGlue" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../mmtk/index.html"><img class="rust-logo" src="../../rust-logo.png" alt="logo"></a><nav class="sub"><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><h1 class="fqn"><span class="in-band">Trait <a href="../index.html">mmtk</a>::<wbr><a href="index.html">vm</a>::<wbr><a class="trait" href="#">ReferenceGlue</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#16-62" title="goto source code">[src]</a></span></h1><div class="docblock item-decl"><pre class="rust trait"><code>pub trait ReferenceGlue&lt;VM:&nbsp;<a class="trait" href="trait.VMBinding.html" title="trait mmtk::vm::VMBinding">VMBinding</a>&gt; {
    type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="reference_glue/trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a>;
    fn <a href="#tymethod.get_referent" class="fnname">get_referent</a>(object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>;
<div class="item-spacer"></div>    fn <a href="#tymethod.set_referent" class="fnname">set_referent</a>(reff: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>);
<div class="item-spacer"></div>    fn <a href="#tymethod.enqueue_references" class="fnname">enqueue_references</a>(references: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.slice.html">&amp;[</a><a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a><a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.slice.html">]</a>, tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>);

    fn <a href="#method.clear_referent" class="fnname">clear_referent</a>(new_reference: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) { ... }
<div class="item-spacer"></div>    fn <a href="#method.is_referent_cleared" class="fnname">is_referent_cleared</a>(referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a> { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>VM-specific methods for reference processing, including weak references, and finalizers.
We handle weak references and finalizers differently:</p>
<ul>
<li>for weak references, we assume they are implemented as normal reference objects (also known as weak objects)
with a referent that is actually weakly reachable. This trait provides a few methods to access
the referent of such an reference object.</li>
<li>for finalizers, we provide a <code>Finalizable</code> trait, and require bindings to specify a type
that implements <code>Finalizable</code>. When the binding registers or pops a finalizable object
from MMTk, the specified type is used for the finalizable objects. For most languages,
they can just use <code>ObjectReference</code> for the finalizable type, meaning that they are registering
and popping a normal object reference as finalizable objects.</li>
</ul>
</div></details><h2 id="associated-types" class="small-section-header">Associated Types<a href="#associated-types" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedtype.FinalizableType" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#18" title="goto source code">[src]</a></div><h4 class="code-header">type <a href="#associatedtype.FinalizableType" class="associatedtype">FinalizableType</a>: <a class="trait" href="reference_glue/trait.Finalizable.html" title="trait mmtk::vm::reference_glue::Finalizable">Finalizable</a></h4></div></summary><div class="docblock"><p>The type of finalizable objects. This type is used when the binding registers and pops finalizable objects.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.get_referent" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#37" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.get_referent" class="fnname">get_referent</a>(object: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a></h4></div></summary><div class="docblock"><p>Get the referent from a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>object</code>: The object reference.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.set_referent" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#44" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.set_referent" class="fnname">set_referent</a>(reff: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>, referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></div></summary><div class="docblock"><p>Set the referent in a weak reference object.</p>
<p>Arguments:</p>
<ul>
<li><code>reff</code>: The object reference for the reference.</li>
<li><code>referent</code>: The referent object reference.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.enqueue_references" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#61" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.enqueue_references" class="fnname">enqueue_references</a>(references: <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.slice.html">&amp;[</a><a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a><a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.slice.html">]</a>, tls: <a class="struct" href="../util/opaque_pointer/struct.VMWorkerThread.html" title="struct mmtk::util::opaque_pointer::VMWorkerThread">VMWorkerThread</a>)</h4></div></summary><div class="docblock"><p>For weak reference types, if the referent is cleared during GC, the reference
will be added to a queue, and MMTk will call this method to inform
the VM about the changes for those references. This method is used
to implement Java’s ReferenceQueue.
Note that this method is called for each type of weak references during GC, and
the references slice will be cleared after this call is returned. That means
MMTk will no longer keep these references alive once this method is returned.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.clear_referent" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#27-31" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.clear_referent" class="fnname">clear_referent</a>(new_reference: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>)</h4></div></summary><div class="docblock"><p>Weak and soft references always clear the referent
before enqueueing.</p>
<p>Arguments:</p>
<ul>
<li><code>new_reference</code>: The reference whose referent is to be cleared.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.is_referent_cleared" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/mmtk/vm/reference_glue.rs.html#50-52" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.is_referent_cleared" class="fnname">is_referent_cleared</a>(referent: <a class="struct" href="../util/address/struct.ObjectReference.html" title="struct mmtk::util::address::ObjectReference">ObjectReference</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.59.0/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Check if the referent has been cleared.</p>
<p>Arguments:</p>
<ul>
<li><code>referent</code>: The referent object reference.</li>
</ul>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../../implementors/mmtk/vm/trait.ReferenceGlue.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="mmtk" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.59.0 (9d1b2106e 2022-02-23)" ></div>
</body></html>